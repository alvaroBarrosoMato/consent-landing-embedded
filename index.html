
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Two‑Step Consent Flow</title>
  <meta name="description" content="Two-step consent flow with OneTrust email prefill before mount."/>

  <!-- Minimal, modern styling -->
  <style>
    :root {
      --bg: #f4f6f8;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --border: #e5e7eb;
      --input-bg: #f9fafb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 40px 16px; background: var(--bg); color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      display: flex; justify-content: center; align-items: flex-start;
    }
    .card {
      width: 100%; max-width: 560px; background: var(--card);
      border-radius: 16px; padding: 28px; box-shadow: 0 12px 32px rgba(0,0,0,0.08);
      animation: fadeIn .24s ease;
    }
    h2 { margin: 0 0 8px; font-weight: 700; }
    p.sub { margin: 0 0 20px; color: var(--muted); }
    label { display: block; margin: 14px 0 6px; font-weight: 600; }
    input, select {
      width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border);
      background: var(--input-bg); font-size: 1rem; transition: border-color .2s, background .2s;
    }
    input:focus, select:focus { outline: none; border-color: var(--primary); background: #fff; }
    .actions { margin-top: 18px; display: flex; gap: 12px; }
    button {
      flex: 1; padding: 14px; border: none; border-radius: 10px; cursor: pointer;
      font-weight: 700; font-size: 1rem;
    }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-ghost { background: transparent; color: var(--text); border: 1px solid var(--border); }
    .hidden { display: none; }
    #ot-container { margin-top: 16px; min-height: 64px; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(8px);} to {opacity:1; transform: translateY(0);} }
  </style>
</head>
<body>

  <!-- STEP 1 -->
  <section id="step1" class="card" aria-label="Step 1: Your details">
    <h2>Your Details</h2>
    <p class="sub">Tell us who you are. On the next step, you’ll manage your consent preferences.</p>

    <div>
      <label for="firstName">First name</label>
      <input id="firstName" type="text" placeholder="e.g. Álvaro"/>
    </div>

    <div>
      <label for="email">Email *</label>
      <input id="email" type="email" placeholder="alvaro@example.com" required/>
    </div>

    <div>
      <label for="country">Country/Region</label>
      <select id="country">
        <option value="">Select…</option>
        <option value="ES">Spain</option>
        <option value="PT">Portugal</option>
        <option value="FR">France</option>
        <option value="DE">Germany</option>
        <option value="UK">United Kingdom</option>
        <option value="US">United States</option>
        <option value="MX">Mexico</option>
        <option value="BR">Brazil</option>
      </select>
    </div>

    <div class="actions">
      <button id="nextBtn" class="btn-primary" type="button">Next</button>
    </div>
  </section>

  <!-- STEP 2 -->
  <section id="step2" class="card hidden" aria-label="Step 2: Consent form">
    <h2>Manage Your Consent</h2>
    <p class="sub">Review and update your consent preferences below.</p>

    <!-- OneTrust embedded form mounts here -->
    <div id="ot-container" aria-label="OneTrust web form container"></div>

    <div class="actions">
      <button id="backBtn" class="btn-ghost" type="button">Back</button>
    </div>
  </section>

  <!-- OneTrust Form Stub (TRIAL). If using PROD, change both host and worker accordingly. -->
  <script
    src="https://privacyportaltrial.onetrust.com/consent-embedded-forms/consent-receipt-scripts/OtFormStub.js"
    data-id="c9322d35-cb63-4974-b65a-5d415f818a05"
    worker="https://consent-api-trial.onetrust.com">
  </script>

  <!-- Unified, simplified logic: prefill FIRST, then mount -->
  <script>
    // ---- Configure these two constants if needed ----
    const EMAIL_LABEL = "Email"; // If your default-language label is Spanish, set to "Correo electrónico"
    const COLLECTION_POINT_ID = "c9322d35-cb63-4974-b65a-5d415f818a05";

    // Ensure the command queue exists
    function ensureStubQueue() {
      window.OtConsentStub = window.OtConsentStub || [];
      return window.OtConsentStub;
    }

    // Wire UI
    window.addEventListener('DOMContentLoaded', () => {
      const step1   = document.getElementById('step1');
      const step2   = document.getElementById('step2');
      const nextBtn = document.getElementById('nextBtn');
      const backBtn = document.getElementById('backBtn');

      backBtn?.addEventListener('click', () => {
        step2.classList.add('hidden');
        step1.classList.remove('hidden');
      });

      nextBtn?.addEventListener('click', () => {
        const email = document.getElementById('email')?.value?.trim();
        if (!email) { alert('Please enter your email to continue.'); return; }

        // Show Step 2 screen (container is visible, but not mounted yet)
        step1.classList.add('hidden');
        step2.classList.remove('hidden');

        // Queue: PREFILL first, then MOUNT the component
        const queue = ensureStubQueue();
        queue.push(function(api) {
          // 1) Pre-fill before mount (preferred path)
          if (window.OneTrust?.webform?.preFill) {
            const payload = {}; payload[EMAIL_LABEL] = email;
            OneTrust.webform.preFill(payload, COLLECTION_POINT_ID);
          } else if (window.OneTrust?.webform?.prefill) {
            // Some tenants expose lower-case 'prefill'
            const payload = {}; payload[EMAIL_LABEL] = email;
            OneTrust.webform.prefill(payload, COLLECTION_POINT_ID);
          } else if (typeof window.OtSdk === 'function') {
            // Fallback if preFill surface isn't exposed yet in this environment
            const payload = {}; payload[EMAIL_LABEL] = email;
            OtSdk("consent", "preFill", payload, COLLECTION_POINT_ID);
          }

          // 2) Mount into #ot-container (the component loads with the prefill value)
          api.init({ container: "ot-container" });
        });
      });
    });
  </script>
</body>
</html>
